build:
  image: cblomart/rpi-basebuild
  commands:
    - CC=musl-gcc CCGLAGS="-static" GOOS=linux GOARCH=arm GOARM=5 go get -ldflags '-linkmode external -s -w -extldflags "-static"' -a github.com/kabukky/journey
    - pushd $GOPATH/src/githun/kabukky/journey
    - git submodule update --init --recursive
    - popd
    - cp $(which journey) ./
    - cp -r $GOPATH/src/githun/kabukky/journey/built-in ./
    - cp -r $GOPATH/src/githun/kabukky/journey/content ./
publish:
  docker:
    username: cblomart
    password: $$DOCKERHUB_PASS
    email: cblomart@gmail.com
    repo: cblomart/rpi-journey
    insecure: true
    tag:
       - $$BRANCH
       - $$COMMIT
       - latest
